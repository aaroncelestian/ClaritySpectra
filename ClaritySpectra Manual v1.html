<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Raman Analysis App</title>
  <meta name="Author" content="Aaron Celestian">
  <meta name="CreationTime" content="2025-04-30T21:19:26Z">
  <meta name="ModificationTime" content="2025-04-30T21:19:26Z">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 13.0px 0.0px 0.0px 0.0px; font: 28.0px 'Helvetica Neue'}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px 'Helvetica Neue'; color: #000000; min-height: 12.0px}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px 'Helvetica Neue'; color: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px 'Helvetica Neue'; color: #000000; min-height: 19.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'; color: #000000; min-height: 23.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px 'Helvetica Neue'; color: #000000; min-height: 18.0px}
    p.p9 {margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; color: #000000; min-height: 23.0px}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px 'Helvetica Neue'; color: #000000}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; color: #000000; min-height: 14.0px}
    p.p13 {margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; color: #000000}
    p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 11.0px 'Helvetica Neue'; color: #000000}
    p.p17 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; color: #000000}
    p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 11.0px Helvetica; color: #000000; color: rgba(0, 0, 0, 0.85); min-height: 13.0px}
    p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #2a2c33}
    p.p20 {margin: 0.0px 0.0px 15.9px 0.0px; font: 12.0px Times; color: #000000}
    p.p21 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    p.p25 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p27 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; -webkit-text-stroke: #000000}
    p.p28 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p31 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p32 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p33 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 12.0px Times; -webkit-text-stroke: #000000}
    li.li4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px 'Helvetica Neue'; color: #000000}
    li.li11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; color: #000000}
    li.li25 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    li.li27 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; -webkit-text-stroke: #000000}
    li.li28 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    li.li35 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    span.s1 {font: 12.0px 'Helvetica Neue'}
    span.s2 {font: 12.0px Times}
    span.s3 {font: 13.0px Courier}
    span.s4 {text-decoration: underline}
    span.s5 {font: 13.2px 'Helvetica Neue'}
    span.s6 {font: 11.0px Times}
    span.s7 {font: 11.0px 'Lucida Grande'}
    span.s8 {font: 14.4px Times}
    span.s9 {font: 12.0px 'Apple Symbols'}
    span.s10 {font: 12.0px 'Times New Roman'}
    span.s11 {font-kerning: none}
    span.s12 {font: 13.0px Menlo; font-kerning: none}
    span.s13 {-webkit-text-stroke: 0px #000000}
    span.s14 {font: 12.0px 'Apple Symbols'; font-kerning: none}
    span.s15 {font: 13.0px Courier; font-kerning: none}
    span.s16 {font: 12.0px 'Times New Roman'; font-kerning: none}
    table.t1 {border-collapse: collapse}
    td.td1 {width: 234.0px; height: 17.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td2 {width: 234.0px; height: 17.0px; background-color: #f2f2f2; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td3 {width: 146.6px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    td.td4 {width: 173.8px; margin: 0.5px 0.5px 0.5px 0.5px; padding: 1.0px 1.0px 1.0px 1.0px}
    ol.ol1 {list-style-type: decimal}
    ul.ul1 {list-style-type: disc}
    ul.ul2 {list-style-type: circle}
    ul.ul3 {list-style-type: square}
  </style>
</head>
<body>
<div style="width: 600px; margin: 0 auto">

<p class="p1">ClaritySpecra User Manual v1</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>Table of Contents</b></h1>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4">Introduction</li>
  <li class="li4">Installation</li>
  <li class="li4">Getting Started</li>
  <li class="li4">Importing Spectra</li>
  <li class="li4">Spectrum Processing</li>
  <li class="li4">Database Management</li>
  <li class="li4">Search and Matching</li>
  <li class="li4">Data Export</li>
  <li class="li4">Troubleshooting</li>
  <li class="li4">Appendices</li>
</ol>
<p class="p3"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>1. Introduction</b></h1>
<p class="p4">The Raman Spectrum Analysis Tool is a comprehensive software package for importing, analyzing, and identifying Raman spectra. This application is designed for researchers, geologists, materials scientists, and other professionals who work with Raman spectroscopy data.</p>
<p class="p3"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>1.1 Key Features</b></h2>
<ul class="ul1">
  <li class="li4">Import Raman spectra from various file formats</li>
  <li class="li4">Baseline correction and peak detection</li>
  <li class="li4">Spectrum database management</li>
  <li class="li4">Advanced search and matching algorithms</li>
  <li class="li4">Hey Classification integration for mineral identification</li>
  <li class="li4">Customizable visualization options</li>
  <li class="li4">Export capabilities for reports and results</li>
</ul>
<p class="p3"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>2. Installation</b></h1>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>2.1 System Requirements</b></h2>
<ul class="ul1">
  <li class="li4"><b>Operating System</b>: Windows 10/11, macOS 10.14+, or Linux</li>
  <li class="li4"><b>Processor</b>: 1.6 GHz or faster</li>
  <li class="li4"><b>RAM</b>: 4 GB minimum (8 GB recommended)</li>
  <li class="li4"><b>Storage</b>: 500 MB free space</li>
  <li class="li4"><b>Display</b>: 1280 x 800 or higher resolution</li>
</ul>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>2.2 Installation Steps</b></h2>
<ol class="ol1">
  <li class="li4">Download the installer package from the official website</li>
  <li class="li4">Run the installer and follow the on-screen instructions</li>
  <li class="li4">Launch the application from your Start menu, Applications folder, or desktop shortcut</li>
</ol>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>2.3 Manual Installation (Advanced Users)</b></h2>
<p class="p4">If you prefer to install from source:</p>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4">Ensure Python 3.8+ is installed on your system</li>
  <li class="li4"><span class="s1"></span><span class="s2">Clone the repository: </span>git clone https://github.com/username/raman-analyzer.git</li>
  <li class="li4">Navigate to the project directory: <span class="s3">cd raman-analyzer</span></li>
  <li class="li4">Install required dependencies: <span class="s3">pip install -r requirements.txt</span></li>
  <li class="li4"><span class="s1"></span><span class="s2">Run the application: </span>python raman_analysis_app.py</li>
</ol>
<p class="p3"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>2.4 Database Installation</b></h2>
<p class="p4">The database is too large for me to have on GitHub (25MB limit).<span class="Apple-converted-space">  </span>There two options:</p>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4">Download a precompiled database with Hey Index classification already down
  <ol class="ol1">
    <li class="li4">This is the easiest: goto <a href="https://drive.google.com/file/d/1LZ8Tp0jGij4VUVILiDvyl9RFyf7H8KaW/view?usp=drive_link"><span class="s4">https://drive.google.com/file/d/1LZ8Tp0jGij4VUVILiDvyl9RFyf7H8KaW/view?usp=drive_link</span></a><span class="Apple-converted-space"> </span></li>
    <li class="li4">Put this file in the same folder as all the *.py files.<span class="Apple-converted-space">  </span>ClaritySpec will recognize and and load it (don’t change the filename).</li>
  </ol></li>
  <li class="li4">Build the database yourself
  <ol class="ol1">
    <li class="li4">You only need a bunch of spectra in a folder.
    <ol class="ol1">
      <li class="li4">You can get these from <a href="http://rruff.info"><span class="s4">rruff.info</span></a></li>
      <li class="li4">Goto the Database tab and in the Database management area, click on Batch Import Spectra
      <ol class="ol1">
        <li class="li4">don’t worry if this looks like it is not responding, depending on the database size (RRUFF is about 6,000 spectra) it could take 20 or 30 minutes.<span class="Apple-converted-space">  </span>You can can see the *.pkl file changing size as the database is changing.<span class="Apple-converted-space">  </span>That is your indication that things are ok.</li>
      </ol></li>
      <li class="li4">Once that is done, you can add the Hey Classification by clicking the Update Hey Classification.<span class="Apple-converted-space">  </span>This is pretty quick.</li>
    </ol></li>
  </ol></li>
</ol>
<p class="p3"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>3. Getting Started</b></h1>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>3.1 Application Interface Overview</b></h2>
<p class="p4">When you first open the application, you'll see a window divided into two main sections:</p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span><b>Left panel</b>: Spectrum visualization area</li>
  <li class="li4"><span class="s5"></span><b>Right panel</b>: Control tabs (File, Processing, Search, Database)</li>
</ul>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>3.2 Navigation</b></h2>
<p class="p4">The right panel contains four tabs that organize the application's functionality:</p>
<p class="p3"><br></p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span><b>File</b>: Import, save, and manage spectrum metadata</li>
  <li class="li4"><span class="s5"></span><b>Processing</b>: Background subtraction and peak finding operations</li>
  <li class="li4"><span class="s5"></span><b>Search-Match</b>: Search database for matching spectra</li>
  <li class="li4"><span class="s5"></span><b>Database</b>: Add, remove, and browse spectra in the database</li>
</ul>
<p class="p7"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>4. Importing Spectra Into The Database</b></h1>
<p class="p6"><b><span class="Apple-converted-space"> </span></b></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>4.1 Supported File Formats</b></h2>
<p class="p4">The application supports various text-based formats containing Raman spectrum data:</p>
<p class="p3"><br></p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>CSV (comma-separated values)</li>
  <li class="li4"><span class="s5"></span>TXT (tab or space-delimited)</li>
  <li class="li4"><span class="s5"></span>Custom formats with metadata headers (lines starting with # have meta information)</li>
</ul>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>4.2 Importing a Single Spectrum</b></h2>
<ol class="ol1">
  <li class="li4">Click the <b>File</b> tab in the right panel</li>
  <li class="li4">Click the Import Spectrum button</li>
  <li class="li4">Browse to locate your spectrum file</li>
  <li class="li4">Select the file and click <b>Open</b><b></b></li>
</ol>
<p class="p3"><br></p>
<p class="p4">The spectrum will appear in the visualization panel, and any metadata from the file will be displayed in the Metadata section.</p>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>4.3 Batch Import</b></h2>
<p class="p4">For importing multiple spectra at once:</p>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4">Go to the <b>Database</b> tab</li>
  <li class="li4">Click Batch Import Spectra</li>
  <li class="li4">Select a folder containing multiple spectrum files</li>
  <li class="li4">Monitor the progress in the import window</li>
  <li class="li4">Click <b>Close</b> when the import is complete</li>
</ol>
<p class="p7"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>5. Spectrum Processing</b></h1>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>5.1 Background Subtraction</b></h2>
<p class="p4">To remove background fluorescence from your spectrum:</p>
<p class="p3"><br></p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>Select the <b>Processing</b> tab</li>
  <li class="li4"><span class="s5"></span>Adjust the baseline parameters:
  <ul class="ul1">
    <li class="li4"><span class="s5"></span><b>λ (lambda)</b>: Controls smoothness (higher values = smoother baseline)</li>
    <li class="li4"><span class="s5"></span><b>p</b>: Controls asymmetry (lower values = more fitting to peaks)</li>
  </ul></li>
  <li class="li4"><span class="s5"></span>Click Subtract Background
  <ul class="ul1">
    <li class="li4"><span class="s5"></span>If you don’t like how the background fit, then import the data again.</li>
    <li class="li4"><span class="s5"></span>A fast way to import the data again is: <b>File &gt; Import Spectrum</b>, that way you are not switching between tabs.</li>
  </ul></li>
</ul>
<p class="p3"><br></p>
<p class="p4">The processed spectrum will appear in the visualization panel.</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>5.2 Peak Finding</b></h2>
<p class="p4">To detect peaks in your spectrum:</p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>In the <b>Processing</b> tab, adjust the peak detection parameters:
  <ul class="ul1">
    <li class="li4"><span class="s5"></span><b>Peak Height Threshold</b>: Minimum intensity for peak detection</li>
    <li class="li4"><span class="s5"></span><b>Min. Peak Distance</b>: Minimum separation between peaks</li>
    <li class="li4"><span class="s5"></span><b>Peak Prominence</b>: How much a peak stands out from surrounding baseline</li>
  </ul></li>
  <li class="li4"><span class="s5"></span>Click Find Peaks</li>
  <li class="li4"><span class="s5"></span>Keep changing the values until you are satisfied</li>
  <li class="li4"><span class="s5"></span>Numbers in the [ ] are suggested values</li>
</ul>
<p class="p3"><br></p>
<p class="p4">Detected peaks will be marked on the spectrum with red dots and labeled with their wavenumber positions.</p>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>5.3 Display Options<span class="Apple-converted-space"> </span></b></h2>
<p class="p4">Customize the visualization with the display options:</p>
<ul class="ul1">
  <li class="li4"><span class="s6"><b></b></span><b>Show Background</b>: Toggle display of the estimated background</li>
  <li class="li4"><span class="s6"><b></b></span><b>Show Peaks</b>: Toggle display of detected peaks</li>
</ul>
<p class="p7"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>6. Database Management</b></h1>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>6.1 Adding Spectra to Database</b></h2>
<p class="p4">After importing and processing a spectrum:</p>
<ol class="ol1">
  <li class="li4"><span class="s6"></span>Go to the <b>Database</b> tab</li>
  <li class="li4"><span class="s6"></span>Enter a name for the spectrum in the <b>Spectrum Name</b> field</li>
  <li class="li4"><span class="s6"></span>Click Add Current Spectrum</li>
</ol>
<p class="p4">The spectrum and its metadata will be saved to the database.</p>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>6.2 Viewing the Database</b></h2>
<p class="p4">To browse the database contents:</p>
<ol class="ol1">
  <li class="li4"><span class="s6"></span>In the Database tab, click View/Search Database</li>
  <li class="li4"><span class="s6"></span>A new window will open showing all database entries</li>
  <li class="li4"><span class="s6"></span>Use the search field to filter entries</li>
  <li class="li4"><span class="s6"></span>Select an entry to view its details</li>
</ol>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>6.3 Editing Metadata</b></h2>
<p class="p4">To edit metadata for a spectrum:</p>
<ol class="ol1">
  <li class="li4"><span class="s6"></span>Select a spectrum in the database viewer</li>
  <li class="li4"><span class="s6"></span>Click Edit Metadata</li>
  <li class="li4"><span class="s6"></span>Modify the fields in the metadata editor</li>
  <li class="li4"><span class="s6"></span>Click <b>Save Metadata</b> when finished</li>
</ol>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>6.4 Hey Classification</b></h2>
<p class="p4">The application integrates Hey Classification for mineral identification:</p>
<ol class="ol1">
  <li class="li4"><span class="s6"></span>Click <b>Update Hey Classification</b> to update all database entries</li>
  <li class="li4"><span class="s6"></span>Or use the metadata editor to lookup Hey Classification for individual entries</li>
</ol>
<p class="p7"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>7. Search and Matching</b></h1>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>7.1 Basic Search</b></h2>
<p class="p4">To find spectra similar to your current spectrum:</p>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4">Go to the <b>Search</b> tab</li>
  <li class="li4">Set the desired number of matches and similarity threshold</li>
  <li class="li4">Select a matching algorithm:
  <ol class="ol1">
    <li class="li4"><b>Combined</b>: Uses correlation, peak matching, and MSE (recommended)</li>
    <li class="li4"><b>Correlation</b>: Based on spectral correlation coefficient only</li>
    <li class="li4"><b>Peak Matching</b>: Compares peak positions only (first using Find Peaks for this to work)</li>
  </ol></li>
  <li class="li4">Click Search Match</li>
</ol>
<p class="p8"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>7.2 Advanced Search</b></h2>
<p class="p4">For more targeted searches:</p>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4">Select the Advanced Search sub-tab</li>
  <li class="li4">Enter specific peak positions to search for</li>
  <li class="li4">Set the peak tolerance (in cm<span class="s7">⁻</span>¹)</li>
  <li class="li4">Select a Hey Classification filter if desired</li>
  <li class="li4">Click Advanced Search</li>
</ol>
<p class="p8"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>7.3 Interpreting Results</b></h2>
<p class="p4">Search results appear in a new window with three tabs:</p>
<ol class="ol1">
  <li class="li4"></li>
  <li class="li4"><b>Spectral Comparison</b>: Visual comparison between query and match</li>
  <li class="li4"><b>Correlation Analysis</b>: Heatmap showing regional correlation</li>
  <li class="li4"><b>Report</b>: Detailed text report of the match</li>
</ol>
<p class="p3"><br></p>
<p class="p4">The left panel shows all matches sorted by similarity score.</p>
<p class="p9"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>Search-Match Performance and Usage Comparisons</b></h1>
<p class="p6"><b></b><br></p>
<p class="p10"><b>Execution Speed:</b></p>
<ul class="ul1">
  <li class="li11"><span class="s8"></span>Fastest: Correlation search (simple matrix operation)</li>
  <li class="li11"><span class="s8"></span>Medium: Peak-based search (set operations)</li>
  <li class="li11"><span class="s8"></span>Slowest: ML-based search (requires PCA computation)</li>
  <li class="li11"><span class="s8"></span>Moderate: Combined search (multiple calculations but optimized)</li>
</ul>
<p class="p12"><br></p>
<p class="p10"><b>Memory Usage:</b></p>
<ul class="ul1">
  <li class="li11"><span class="s8"></span>Lowest: Peak-based search (only uses peak positions)</li>
  <li class="li11"><span class="s8"></span>Medium: Correlation search (full spectra but simple operations)</li>
  <li class="li11"><span class="s8"></span>Highest: ML-based search (stores transformed data in PCA space)</li>
  <li class="li11"><span class="s8"></span>Medium-High: Combined search (requires multiple metrics)</li>
</ul>
<p class="p12"><br></p>
<p class="p13"><b>Effectiveness by Scenario:</b></p>
<table width="100%" cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p14"><b>Scenario</b><b></b></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p14"><b>Best Method</b><b></b></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td2">
        <p class="p14">Clean, high-quality spectra</p>
      </td>
      <td valign="middle" class="td2">
        <p class="p14">Correlation or Combined</p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p14">Noisy spectra with clear peaks</p>
      </td>
      <td valign="middle" class="td1">
        <p class="p14">Peak-based</p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td2">
        <p class="p14">Spectra with baseline issues</p>
      </td>
      <td valign="middle" class="td2">
        <p class="p14">Peak-based or ML-based</p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p14">Complex mixtures</p>
      </td>
      <td valign="middle" class="td1">
        <p class="p14">ML-based or Combined</p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td2">
        <p class="p14">General-purpose</p>
      </td>
      <td valign="middle" class="td2">
        <p class="p14">Combined (hence "Recommended")</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p4">The application intelligently handles the choice of search algorithm based on user selection, and falls back to the Combined method if ML-based search is selected but scikit-learn is unavailable.</p>
<p class="p7"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>Examples</b></h1>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>Example 1. A Mineral</b></h2>
<p class="p3"><br></p>
<p class="p4">For this example, I’ll use a mineral that has broad peaks and a moderately high background.<span class="Apple-converted-space">   </span></p>
<p class="p4"><img src="Images/hilarite.jpg" width="100%" alt="Image"></p>
<p class="p3"><br></p>
<p class="p4">The figure above shows the background fitting and resulting spectrum.<span class="Apple-converted-space">  </span>You can see the parameters I used in the figure.</p>
<p class="p3"><br></p>
<p class="p4">Next, I went through all the different types of search methods, and found that the ML tool results in the best fitting (see below).<span class="Apple-converted-space">  </span>This was expected as the data is noisier than one would like.<span class="Apple-converted-space">  </span>Similar minerals like georgechaoite and gaidonayite also appeared in the result list (these are all similar minerals).</p>
<p class="p4"><span class="Apple-converted-space"> </span><img src="Images/hilarite sm.jpg" width="100%" alt="Image"></p>
<p class="p3"><br></p>
<p class="p4">The heat map belowalso shows a good fit in the med and mid finger print regions.<span class="Apple-converted-space">  </span>The lattice modes didn’t fit all that well, but this was a non dominant part of the spectrum.<span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p4"><img src="Images/hilarite heat.jpg" width="100%" alt="Image"></p>
<p class="p3"><br></p>
<p class="p4">It’s best to explore and test different approaches and use the tools as a guide. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>Example 2. Plastic</b></h2>
<p class="p4">After background subtraction and peak searching, the ML search tool found a near perfect fit to polyethylene.<span class="Apple-converted-space">  </span>This particular piece was found inside a turtle.<span class="Apple-converted-space"> </span></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b><img src="Images/plastic.jpg" width="100%" alt="Image"></b><b>Example 3. A Liquid</b></h2>
<p class="p3"><br></p>
<p class="p4">For this example, I want to see the H2O / OH vibrational modes and the anion vibrational modes.<span class="Apple-converted-space">  </span>I’m not expecting a good fit because there are no liquid Raman spectra in my database.<span class="Apple-converted-space">  </span>But, maybe I can find something similar and see the general molecular composition of the liquid.</p>
<p class="p3"><br></p>
<p class="p4"><img src="Images/First - Liquid Raman.jpg" width="100%" alt="Image"></p>
<p class="p3"><br></p>
<p class="p4">Doing a Combined search, you can see that only sulfate minerals are shown, indicating, that the spectrum is a sulfate salt saturated solution.<span class="Apple-converted-space">  </span>Heatmap plot shows really good fitting at the mid finger print region, but poor fitting at the CH/OH region (because the data base didn’t go out that far).<span class="Apple-converted-space">  </span>Clicking on the report will reveal all the details of the Match results. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p4"><img src="Images/corerealtion liquid.jpg" width="100%" alt="Image"></p>
<p class="p3"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>8. Data Export</b></h1>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>8.1 Exporting Spectra</b></h2>
<p class="p4">To save the current spectrum:</p>
<p class="p3"><br></p>
<ol class="ol1">
  <li class="li4">Go to the <b>File</b> tab</li>
  <li class="li4">Click Save Current Spectrum</li>
  <li class="li4">Choose a location and format</li>
  <li class="li4">Click <b>Save</b><b></b></li>
</ol>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>8.2 Exporting Reports</b></h2>
<p class="p4">After performing a search, you can export the results:</p>
<ol class="ol1">
  <li class="li4">Go to the <b>Report</b> tab in the results window</li>
  <li class="li4">Click one of the export buttons:
  <ol class="ol1">
    <li class="li4"><b>Export as PDF</b>: Creates a formatted PDF report</li>
    <li class="li4"><b>Export as Text</b>: Saves as plain text</li>
    <li class="li4"><b>Export as CSV</b>: Creates a spreadsheet-compatible file</li>
  </ol></li>
</ol>
<p class="p7"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>9. Troubleshooting</b></h1>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>9.1 Common Issues</b></h2>
<p class="p4"><b>Application Won't Start And If It Does, I Don’t See The Controls</b></p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>Ensure your system meets the minimum requirements</li>
  <li class="li4"><span class="s5"></span>If a window pops-up, expand the window as some systems don’t read my default window sizes</li>
</ul>
<p class="p4"><b>Import Errors</b></p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>Verify the file format is supported</li>
  <li class="li4"><span class="s5"></span>Check that the file is not corrupted</li>
  <li class="li4"><span class="s5"></span>Ensure file contains both wavenumber and intensity columns</li>
</ul>
<p class="p4"><b>Processing Issues</b></p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>Try different baseline parameters for difficult spectra</li>
  <li class="li4"><span class="s5"></span>Use "Auto" settings for peak detection on first attempt</li>
  <li class="li4"><span class="s5"></span>For noisy spectra, consider preprocessing with smoothing so that ClaritySpec can find the peaks</li>
</ul>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>9.2 Getting Help</b></h2>
<p class="p4">For additional support:</p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>Check this document :)</li>
  <li class="li4"><span class="s5"></span>Contact me <a href="mailto:acelestian@nhm.org"><span class="s4">acelestian@nhm.org</span></a> but please allow me a bit of time to get back to you.</li>
</ul>
<p class="p7"><b></b><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px 'Helvetica Neue'"><b>10. Appendices</b></h1>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>10.1 Keyboard Shortcuts</b></h2>
<p class="p4">These may not work on all systems.</p>
<p class="p3"><br></p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span><b>Ctrl+I</b>: Import spectrum</li>
  <li class="li4"><span class="s5"></span><b>Ctrl+S</b>: Save spectrum</li>
  <li class="li4"><span class="s5"></span><b>Ctrl+B</b>: Subtract background</li>
  <li class="li4"><span class="s5"></span><b>Ctrl+P</b>: Find peaks</li>
  <li class="li4"><span class="s5"></span><b>Ctrl+F</b>: Search/match</li>
  <li class="li4"><span class="s5"></span><b>Ctrl+D</b>: Add to database</li>
</ul>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>10.2 File Format Specifications</b></h2>
<p class="p4">The application works best with files in the following format:</p>
<p class="p3"><br></p>
<p class="p4"># NAME: Quartz</p>
<p class="p4"># RRUFFID: R040031</p>
<p class="p4"># IDEAL CHEMISTRY: SiO2</p>
<p class="p4"># HEY CLASSIFICATION: D. Silicates - Tectosilicates</p>
<p class="p4"># LOCALITY: Brazil</p>
<p class="p4"># DESCRIPTION: Colorless, transparent</p>
<p class="p4">128.0 352</p>
<p class="p4">152.3 1245</p>
<p class="p4">206.5 867</p>
<p class="p4">...</p>
<p class="p4">Where the first column is wavenumber (cm<span class="s7">⁻</span>¹) and the second column is intensity.</p>
<p class="p6"><b></b><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px 'Helvetica Neue'"><b>10.3 Algorithm Descriptions</b></h2>
<p class="p4"><b>Baseline Correction</b></p>
<p class="p4">The application uses Asymmetric Least Squares Smoothing (ALS) for baseline correction, which iteratively fits a smoothed curve to the spectrum's baseline points.</p>
<p class="p4"><b>Peak Finding</b></p>
<p class="p4">Peak detection uses the SciPy <span class="s3">find_peaks</span> function with customizable parameters for height, distance, and prominence.</p>
<p class="p4"><b>Spectrum Matching</b></p>
<p class="p4">The combined matching algorithm uses a weighted combination of:</p>
<ul class="ul1">
  <li class="li4"><span class="s5"></span>Correlation coefficient (60%)</li>
  <li class="li4"><span class="s5"></span>Mean squared error (20%)</li>
  <li class="li4"><span class="s5"></span>Peak position overlap (20%)</li>
</ul>
<p class="p3"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 18.0px Times"><b>Technical Details of Core Algorithms<span class="Apple-converted-space"> </span></b></h1>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Times"><b>Background Subtraction Using Asymmetric Least Squares (ALS)</b></h2>
<p class="p17">The background subtraction method implemented in this software uses the Asymmetric Least Squares algorithm, which is particularly effective for removing fluorescence backgrounds from Raman spectra.</p>
<p class="p13"><b>Mathematical Foundation</b></p>
<p class="p17">The ALS algorithm works by minimizing the following penalized least squares function:</p>
<p class="p18"><br></p>
<p class="p19">S = sum_i w_i(y_i - z_i)² + λ sum_i [(∇²z)_i]²</p>
<p class="p17">Where:</p>
<ul class="ul1">
  <li class="li11">y_i is the observed spectrum intensity at point i</li>
  <li class="li11">z_i is the estimated baseline at point i</li>
  <li class="li11">w_i is an asymmetric weight (different for points above vs. below the baseline)</li>
  <li class="li11">λ is the smoothness parameter (controls how smooth the baseline is)</li>
  <li class="li11"><span class="s9">∇</span>² is the second-order difference operator (approximates second derivative)</li>
</ul>
<p class="p13"><b>Algorithm Implementation</b></p>
<ol class="ol1">
  <li class="li11"><span class="s8"></span>Initialize weights w_i = 1 for all points</li>
  <li class="li11"><span class="s8"></span>For a set number of iterations (typically 10): a. Solve the penalized least squares problem for z using the current weights b. Update weights asymmetrically:
  <ul class="ul2">
    <li class="li11"><span class="s8"></span>If y_i &gt; z_i (point above baseline): w_i = p (small value, e.g., 0.01)</li>
    <li class="li11"><span class="s8"></span>If y_i ≤ z_i (point at/below baseline): w_i = 1-p (large value, e.g., 0.99) c. Repeat with new weights</li>
  </ul></li>
</ol>
<p class="p13"><b>Parameter Effects</b></p>
<ul class="ul1">
  <li class="li11"><b>λ (Lambda)</b>: Controls baseline smoothness
  <ul class="ul2">
    <li class="li11">Higher values (e.g., 1e7) create smoother baselines but may underfit</li>
    <li class="li11">Lower values (e.g., 1e3) allow more flexibility but may follow peaks</li>
    <li class="li11">Typical range: 1e5 to 1e7 for Raman spectra</li>
  </ul></li>
  <li class="li11"><b>p (Asymmetry parameter)</b>: Controls fitting asymmetry
  <ul class="ul2">
    <li class="li11">Smaller values (e.g., 0.001) strongly favor fitting points below the curve</li>
    <li class="li11">Larger values (e.g., 0.1) allow more influence from points above (peaks)</li>
    <li class="li11">Typical range: 0.001 to 0.05 for Raman spectra</li>
  </ul></li>
</ul>
<p class="p13"><b>Implementation Efficiency</b></p>
<p class="p17">The implementation uses sparse matrices for computational efficiency:</p>
<ul class="ul1">
  <li class="li11">The second derivative operator is represented as a sparse difference matrix D</li>
  <li class="li11">The weighted least squares problem becomes a sparse linear system</li>
  <li class="li11">Solution via sparse solvers (spsolve) greatly reduces computation time and memory usage</li>
</ul>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Times"><b>Peak Finding Algorithm</b></h2>
<p class="p17">The peak detection algorithm leverages SciPy's <span class="s3">find_peaks</span> function with specialized parameter handling for Raman spectra.</p>
<p class="p13"><b>Algorithm Steps</b></p>
<ol class="ol1">
  <li class="li11"><span class="s8"></span>Determine if processed (background-subtracted) or raw spectrum should be used</li>
  <li class="li11"><span class="s8"></span>Calculate default parameter values if not specified by user:
  <ul class="ul2">
    <li class="li11"><span class="s8"></span>Height threshold = 5% of maximum intensity</li>
    <li class="li11"><span class="s8"></span>Distance = 1% of spectrum length (in data points)</li>
    <li class="li11"><span class="s8"></span>Prominence = 2% of maximum intensity</li>
  </ul></li>
</ol>
<ol class="ol1">
  <li class="li11"><span class="s8"></span>Call SciPy's <span class="s3">find_peaks</span> function with these parameters</li>
  <li class="li11"><span class="s8"></span>Extract and store peak information:</li>
</ol>
<ol class="ol1">
  <ul class="ul2">
    <li class="li11"><span class="s8"></span>Indices in the original spectrum</li>
    <li class="li11"><span class="s8"></span>Corresponding wavenumber values</li>
    <li class="li11"><span class="s8"></span>Peak heights</li>
    <li class="li11"><span class="s8"></span>Additional properties (prominence, width, etc.)</li>
  </ul>
</ol>
<p class="p13"><b>Parameter Explanations</b></p>
<ul class="ul1">
  <li class="li11"><b>Height</b>: Minimum intensity value to be considered a peak
  <ul class="ul2">
    <li class="li11">Controls sensitivity to minor peaks</li>
    <li class="li11">Adaptive default: 5% of spectrum maximum</li>
  </ul></li>
  <li class="li11"><b>Distance</b>: Minimum separation between peaks
  <ul class="ul2">
    <li class="li11">Prevents detecting multiple points from the same peak</li>
    <li class="li11">Adaptive default: 1% of spectrum length</li>
  </ul></li>
  <li class="li11"><b>Prominence</b>: How much a peak stands out relative to surrounding baseline
  <ul class="ul2">
    <li class="li11">More robust than height for distinguishing real peaks</li>
    <li class="li11">Adaptive default: 2% of spectrum maximum</li>
  </ul></li>
  <li class="li11"><b>Width</b>: Optional constraint on peak width
  <ul class="ul2">
    <li class="li11">Useful for filtering out noise spikes vs. true Raman bands</li>
    <li class="li11">Not set by default, allowing all peak widths</li>
  </ul></li>
</ul>
<p class="p13"><b>Advanced Considerations</b></p>
<p class="p17">The algorithm incorporates several technical enhancements:</p>
<ul class="ul1">
  <li class="li11">Automatic parameter calculation based on spectrum characteristics</li>
  <li class="li11">Wavenumber mapping to associate peak indices with actual Raman shifts</li>
  <li class="li11">Property storage for advanced filtering in search algorithms</li>
  <li class="li11">Scale-invariant defaults that work across diverse intensity scales</li>
</ul>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Times"><b>Search-Match Algorithm</b></h2>
<p class="p17">The search-match functionality implements a sophisticated multi-metric approach that combines spectral correlation, peak matching, and intensity distribution similarity.</p>
<p class="p13"><b>Core Matching Metrics</b></p>
<p class="p20"><b>1. Spectral Correlation Coefficient</b></p>
<ul class="ul1">
  <li class="li11">Pearson correlation coefficient between query and database spectra</li>
  <li class="li11">Measures overall spectral shape similarity</li>
  <li class="li11">Spectrum normalization (0-1 range) for scale invariance</li>
  <li class="li11">Wavenumber interpolation for consistent comparison</li>
  <li class="li11">Mathematical formula: r = cov(X,Y)/(σ_X·σ_Y)</li>
</ul>
<p class="p20"><b>2. Mean Squared Error (MSE)</b></p>
<ul class="ul1">
  <li class="li11">Quantifies point-by-point intensity differences</li>
  <li class="li11">Converted to similarity score using: score = 1/(1+10·MSE)</li>
  <li class="li11">More sensitive to local differences than correlation</li>
  <li class="li11">Complements correlation by focusing on absolute differences</li>
</ul>
<p class="p20"><b>3. Peak Position Matching</b></p>
<ul class="ul1">
  <li class="li11">Jaccard similarity between peak sets: |A<span class="s10">∩</span>B|/|A<span class="s9">∪</span>B|</li>
  <li class="li11">Peaks are rounded to integer wavenumbers for comparison</li>
  <li class="li11">Tolerance parameter allows for slight peak shifts</li>
  <li class="li11">More robust to baseline issues than full-spectrum metrics</li>
</ul>
<p class="p13"><b>Combined Scoring System</b></p>
<p class="p17">The final match score is a weighted combination:</p>
<ul class="ul1">
  <li class="li11">60% Correlation coefficient</li>
  <li class="li11">20% MSE-derived similarity</li>
  <li class="li11">20% Peak position matching</li>
</ul>
<p class="p17">This weighting scheme provides balanced sensitivity to overall spectral shape, intensity differences, and characteristic peak positions.</p>
<p class="p13"><b>Search Optimization</b></p>
<p class="p17">Several optimizations enable efficient searching:</p>
<ol class="ol1">
  <li class="li11">Query spectrum is processed only once before comparison</li>
  <li class="li11">Database spectra are interpolated to query spectrum wavenumbers</li>
  <li class="li11">Normalization is applied dynamically during comparison</li>
  <li class="li11">Early filtering based on threshold reduces computation for large databases</li>
  <li class="li11">Vectorized operations for performance on large datasets</li>
</ol>
<p class="p13"><b>Advanced Search Capabilities</b></p>
<p class="p17">The advanced search enhances this core algorithm with:</p>
<ol class="ol1">
  <li class="li11">Peak position filtering (search by specific peaks of interest)</li>
  <li class="li11">Metadata-based filtering (Hey Classification)</li>
  <li class="li11">Customizable tolerance for peak matching</li>
  <li class="li11">Peak subset matching (match specific regions of interest)</li>
</ol>
<p class="p17">This comprehensive approach enables nuanced spectral matching even in challenging cases with baseline issues, intensity variations, or partial spectral overlap.</p>
<p class="p21"><br></p>
<p class="p22"><br></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Technical Details of Core Algorithms</b></span></h1>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Background Subtraction Using Asymmetric Least Squares (ALS)</b></span></h2>
<p class="p25"><span class="s11">The background subtraction method implemented in this software uses the Asymmetric Least Squares algorithm, which is particularly effective for removing fluorescence backgrounds from Raman spectra.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Mathematical Foundation</b></span></h3>
<p class="p25"><span class="s11">The ALS algorithm works by minimizing the following penalized least squares function:</span></p>
<p class="p27"><span class="s11">S = sum_i w_i(y_i - z_i)² + </span><span class="s12">λ</span><span class="s11"> sum_i [(∇²z)_i]²</span></p>
<p class="p25"><span class="s11">Where:</span></p>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">y_i is the observed spectrum intensity at point i</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">z_i is the estimated baseline at point i</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">w_i is an asymmetric weight (different for points above vs. below the baseline)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">λ is the smoothness parameter (controls how smooth the baseline is)</span></li>
  <li class="li28"><span class="s13"></span><span class="s14">∇</span><span class="s11">² is the second-order difference operator (approximates second derivative)</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Algorithm Implementation</b></span></h3>
<ol class="ol1">
  <li class="li28"><span class="s13"></span><span class="s11">Initialize weights w_i = 1 for all points</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">For a set number of iterations (typically 10): a. Solve the penalized least squares problem for z using the current weights b. Update weights asymmetrically:</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">If y_i &gt; z_i (point above baseline): w_i = p (small value, e.g., 0.01)</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">If y_i ≤ z_i (point at/below baseline): w_i = 1-p (large value, e.g., 0.99) c. Repeat with new weights</span></li>
  </ul></li>
</ol>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Parameter Effects</b></span></h3>
<ul class="ul1">
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>λ (Lambda)</b>: Controls baseline smoothness</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Higher values (e.g., 1e7) create smoother baselines but may underfit</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Lower values (e.g., 1e3) allow more flexibility but may follow peaks</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Typical range: 1e5 to 1e7 for Raman spectra</span></li>
  </ul></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>p (Asymmetry parameter)</b>: Controls fitting asymmetry</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Smaller values (e.g., 0.001) strongly favor fitting points below the curve</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Larger values (e.g., 0.1) allow more influence from points above (peaks)</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Typical range: 0.001 to 0.05 for Raman spectra</span></li>
  </ul></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Implementation Efficiency</b></span></h3>
<p class="p25"><span class="s11">The implementation uses sparse matrices for computational efficiency:</span></p>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">The second derivative operator is represented as a sparse difference matrix D</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">The weighted least squares problem becomes a sparse linear system</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Solution via sparse solvers (spsolve) greatly reduces computation time and memory usage</span></li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000; min-height: 23.0px"><span class="s11"><b></b></span><br></h2>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Peak Finding Algorithm</b></span></h2>
<p class="p25"><span class="s11">The peak detection algorithm leverages SciPy's </span><span class="s15">find_peaks</span><span class="s11"> function with specialized parameter handling for Raman spectra.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Algorithm Steps</b></span></h3>
<ol class="ol1">
  <li class="li28"><span class="s13"></span><span class="s11">Determine if processed (background-subtracted) or raw spectrum should be used</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Calculate default parameter values if not specified by user:</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Height threshold = 5% of maximum intensity</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Distance = 1% of spectrum length (in data points)</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Prominence = 2% of maximum intensity</span></li>
  </ul></li>
  <li class="li28"><span class="s13"></span><span class="s11">Call SciPy's </span><span class="s15">find_peaks</span><span class="s11"> function with these parameters</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Extract and store peak information:</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Indices in the original spectrum</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Corresponding wavenumber values</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Peak heights</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Additional properties (prominence, width, etc.)</span></li>
  </ul></li>
</ol>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Parameter Explanations</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Height</b>: Minimum intensity value to be considered a peak</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Controls sensitivity to minor peaks</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Adaptive default: 5% of spectrum maximum</span></li>
  </ul></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Distance</b>: Minimum separation between peaks</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Prevents detecting multiple points from the same peak</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Adaptive default: 1% of spectrum length</span></li>
  </ul></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Prominence</b>: How much a peak stands out relative to surrounding baseline</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">More robust than height for distinguishing real peaks</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Adaptive default: 2% of spectrum maximum</span></li>
  </ul></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Width</b>: Optional constraint on peak width</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Useful for filtering out noise spikes vs. true Raman bands</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Not set by default, allowing all peak widths</span></li>
  </ul></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Advanced Considerations</b></span></h3>
<p class="p25"><span class="s11">The algorithm incorporates several technical enhancements:</span></p>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Automatic parameter calculation based on spectrum characteristics</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Wavenumber mapping to associate peak indices with actual Raman shifts</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Property storage for advanced filtering in search algorithms</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Scale-invariant defaults that work across diverse intensity scales</span></li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000; min-height: 23.0px"><span class="s11"><b></b></span><br></h2>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Search-Match Algorithm</b></span></h2>
<p class="p25"><span class="s11">The search-match functionality implements a sophisticated multi-metric approach that combines spectral correlation, peak matching, and intensity distribution similarity.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Core Matching Metrics</b></span></h3>
<h4 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>1. Spectral Correlation Coefficient</b></span></h4>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Pearson correlation coefficient between query and database spectra</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Measures overall spectral shape similarity</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Spectrum normalization (0-1 range) for scale invariance</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Wavenumber interpolation for consistent comparison</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Mathematical formula: r = cov(X,Y)/(σ_X·σ_Y)</span></li>
</ul>
<h4 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>2. Mean Squared Error (MSE)</b></span></h4>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Quantifies point-by-point intensity differences</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Converted to similarity score using: score = 1/(1+10·MSE)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">More sensitive to local differences than correlation</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Complements correlation by focusing on absolute differences</span></li>
</ul>
<h4 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>3. Peak Position Matching</b></span></h4>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Jaccard similarity between peak sets: |A</span><span class="s16">∩</span><span class="s11">B|/|A</span><span class="s14">∪</span><span class="s11">B|</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Peaks are rounded to integer wavenumbers for comparison</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Tolerance parameter allows for slight peak shifts</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">More robust to baseline issues than full-spectrum metrics</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Combined Scoring System</b></span></h3>
<p class="p25"><span class="s11">The final match score is a weighted combination:</span></p>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">60% Correlation coefficient</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">20% MSE-derived similarity</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">20% Peak position matching</span></li>
</ul>
<p class="p25"><span class="s11">This weighting scheme provides balanced sensitivity to overall spectral shape, intensity differences, and characteristic peak positions.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Search Optimization</b></span></h3>
<p class="p25"><span class="s11">Several optimizations enable efficient searching:</span></p>
<ol class="ol1">
  <li class="li28"><span class="s13"></span><span class="s11">Query spectrum is processed only once before comparison</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Database spectra are interpolated to query spectrum wavenumbers</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Normalization is applied dynamically during comparison</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Early filtering based on threshold reduces computation for large databases</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Vectorized operations for performance on large datasets</span></li>
</ol>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Advanced Search Capabilities</b></span></h3>
<p class="p25"><span class="s11">The advanced search enhances this core algorithm with:</span></p>
<ol class="ol1">
  <li class="li28"><span class="s13"></span><span class="s11">Peak position filtering (search by specific peaks of interest)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Metadata-based filtering (Hey Classification)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Customizable tolerance for peak matching</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Peak subset matching (match specific regions of interest)</span></li>
</ol>
<p class="p25"><span class="s11">This comprehensive approach enables nuanced spectral matching even in challenging cases with baseline issues, intensity variations, or partial spectral overlap.</span></p>
<p class="p31"><span class="s11"></span><br></p>
<p class="p32"><span class="s11"></span><br></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Detailed Comparison of Search-Match Algorithms in ClaritySpectra</b></span></h1>
<p class="p25"><span class="s11">The Raman Analysis APPLication (RAPPL) implements four distinct search-match approaches, each with different strengths and technical characteristics. Here's a detailed breakdown of how each method works and their differences:</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>1. Correlation-Based Search</b></span></h2>
<p class="p25"><span class="s11">The correlation search (</span><span class="s15">correlation_search</span><span class="s11"> method) is based on the statistical correlation between spectral shapes.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Technical Implementation:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Normalizes both query and database spectra to a 0-1 range</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Interpolates database spectra to match query wavenumbers if needed</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Calculates Pearson correlation coefficient between normalized spectra</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Returns matches above the threshold sorted by correlation score</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Key Characteristics:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Focus</b>: Overall spectral shape similarity</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Strengths</b>: Good at matching similar materials with consistent peak patterns</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Weaknesses</b>: Can be misled by background variations or intensity scaling</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Use Case</b>: Best for clean spectra with minimal background interference</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Code Logic:</b></span></h3>
<p class="p27"><span class="s11"># Core calculation in a simplified form</span></p>
<p class="p27"><span class="s11">corr_coef = np.corrcoef(query_norm, db_norm)[0, 1]</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000; min-height: 23.0px"><span class="s11"><b></b></span><br></h2>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>2. Peak-Based Search</b></span></h2>
<p class="p25"><span class="s11">The peak-based search (</span><span class="s15">peak_based_search</span><span class="s11"> method) compares the positions of significant peaks rather than entire spectral shapes.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Technical Implementation:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Uses Jaccard similarity (intersection over union) between peak sets</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Groups peaks by tolerance to account for slight wavenumber shifts</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Requires peak detection to be done before searching</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Compares rounded peak positions to match peaks within tolerance range</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Key Characteristics:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Focus</b>: Characteristic peak positions only</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Strengths</b>: More robust to baseline variations and intensity differences</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Weaknesses</b>: Ignores overall spectral shape and relative intensities</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Use Case</b>: Ideal for spectra with well-defined characteristic peaks</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Code Logic:</b></span></h3>
<p class="p27"><span class="s11"># Core similarity calculation</span></p>
<p class="p27"><span class="s11">query_set = set(np.round(query_peaks / tolerance))</span></p>
<p class="p27"><span class="s11">db_set = set(np.round(db_peaks_wavenumbers / tolerance))</span></p>
<p class="p27"><span class="s11">intersection = len(query_set.intersection(db_set))</span></p>
<p class="p27"><span class="s11">union = len(query_set.union(db_set))</span></p>
<p class="p27"><span class="s11">jaccard = intersection / union if union &gt; 0 else 0</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000; min-height: 23.0px"><span class="s11"><b></b></span><br></h2>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>3. ML-Based Search</b></span></h2>
<p class="p25"><span class="s11">The ML-based search (</span><span class="s15">ml_based_search</span><span class="s11"> method) uses Principal Component Analysis (PCA) for dimensionality reduction and cosine similarity for matching.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Technical Implementation:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Requires scikit-learn library to be available</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Normalizes and interpolates spectra as with other methods</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Applies StandardScaler to standardize data before PCA</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Uses PCA to extract key features (typically 10 components)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Calculates cosine similarity in the reduced PCA space</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Scales similarity from [-1,1] to [0,1] range for consistency</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Key Characteristics:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Focus</b>: Latent spectral features identified through dimensionality reduction</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Strengths</b>: Can identify subtle patterns that aren't obvious in raw data</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Weaknesses</b>: Requires more computation and depends on having scikit-learn installed</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Use Case</b>: Complex spectra where important features aren't obvious</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Code Logic:</b></span></h3>
<p class="p27"><span class="s11"># Core PCA and similarity calculation</span></p>
<p class="p27"><span class="s11">spectra_scaled = scaler.fit_transform(all_spectra)</span></p>
<p class="p27"><span class="s11">pca = PCA(n_components=n_components)</span></p>
<p class="p27"><span class="s11">spectra_pca = pca.fit_transform(spectra_scaled)</span></p>
<p class="p27"><span class="s11">similarities = cosine_similarity(query_pca, db_pca)[0]</span></p>
<p class="p27"><span class="s11">scaled_similarity = (similarity + 1) / 2<span class="Apple-converted-space">  </span># Convert from [-1,1] to [0,1]</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000; min-height: 23.0px"><span class="s11"><b></b></span><br></h2>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>4. Combined Search (Default Recommended Method)</b></span></h2>
<p class="p25"><span class="s11">The combined method (</span><span class="s15">search_match</span><span class="s11"> method in the </span><span class="s15">RamanSpectra</span><span class="s11"> class) integrates multiple metrics for a more balanced approach.</span></p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Technical Implementation:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Calculates correlation coefficient (as in method 1)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Computes mean squared error and converts to a similarity score</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Calculates peak position matching score (similar to method 2)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Combines these scores with a weighted average:</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">60% correlation coefficient</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">20% MSE-derived similarity</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">20% peak matching score</span></li>
  </ul></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Key Characteristics:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Focus</b>: Balanced consideration of multiple similarity aspects</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Strengths</b>: More robust than any single method alone</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Weaknesses</b>: May not excel at specialized cases where one approach is clearly better</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Use Case</b>: General-purpose searching for most typical scenarios</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Code Logic:</b></span></h3>
<p class="p27"><span class="s11"># Core combined score calculation</span></p>
<p class="p27"><span class="s11">combined_score = 0.6 * corr_coef + 0.2 * mse_score + 0.2 * peak_score</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Performance and Usage Comparisons</b></span></h2>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Execution Speed:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Fastest: Correlation search (simple matrix operation)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Medium: Peak-based search (set operations)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Slowest: ML-based search (requires PCA computation)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Moderate: Combined search (multiple calculations but optimized)</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Memory Usage:</b></span></h3>
<ul class="ul1">
  <li class="li28"><span class="s13"></span><span class="s11">Lowest: Peak-based search (only uses peak positions)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Medium: Correlation search (full spectra but simple operations)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Highest: ML-based search (stores transformed data in PCA space)</span></li>
  <li class="li28"><span class="s13"></span><span class="s11">Medium-High: Combined search (requires multiple metrics)</span></li>
</ul>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Effectiveness by Scenario:</b></span></h3>
<table width="100%" cellspacing="0" cellpadding="0">
  <tbody>
    <tr>
      <td valign="middle" class="td3">
        <p class="p33"><span class="s11"><b>Scenario</b></span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p33"><span class="s11"><b>Best Method</b></span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p28"><span class="s11">Clean, high-quality spectra</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p28"><span class="s11">Correlation or Combined</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p28"><span class="s11">Noisy spectra with clear peaks</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p28"><span class="s11">Peak-based</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p28"><span class="s11">Spectra with baseline issues</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p28"><span class="s11">Peak-based or ML-based</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p28"><span class="s11">Complex mixtures</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p28"><span class="s11">ML-based or Combined</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td3">
        <p class="p28"><span class="s11">General-purpose</span></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p28"><span class="s11">Combined (hence "Recommended")</span></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p25"><span class="s11">The application intelligently handles the choice of search algorithm based on user selection, and falls back to the Combined method if ML-based search is selected but scikit-learn is unavailable.</span></p>
<p class="p31"><span class="s11"></span><br></p>
<p class="p32"><span class="s11"></span><br></p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Python Environment Requirements for ClaritySpectra</b></span></h1>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000"><span class="s11">Here's a detailed description of the Python environment required to successfully run the Raman spectrum analysis tool:</span></h1>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Core Python Environment</b></span></h2>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Python Version</b>: Python 3.8 or newer required (the code uses f-strings and other modern features)</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Platform Support</b>: Cross-platform (Windows, macOS, Linux)</span></li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Essential Packages</b></span></h2>
<p class="p25"><span class="s11">The following packages are absolutely required for the application to function:</span></p>
<ol class="ol1">
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>NumPy</b> (version &gt;= 1.19.0)</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Used for array operations, data manipulation, and numerical calculations</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Core functionality for spectral data handling</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Import statement: </span><span class="s15">import numpy as np</span></li>
  </ul></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>Matplotlib</b> (version &gt;= 3.3.0)</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Used for plotting spectra and visualization</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Required for the interactive plot in the main interface</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Import statements:</span>
    <ul class="ul3">
      <li class="li27"><span class="s13"></span><span class="s11">import matplotlib</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">import matplotlib.pyplot as plt</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg, NavigationToolbar2Tk</span></li>
    </ul></li>
  </ul></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>SciPy</b> (version &gt;= 1.5.0)</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Used for signal processing, peak finding, and sparse matrix operations</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Critical for baseline correction and peak detection algorithms</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Import statements:</span>
    <ul class="ul3">
      <li class="li27"><span class="s13"></span><span class="s11">from scipy.signal import find_peaks, savgol_filter</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from scipy.sparse import csc_matrix</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from scipy.sparse.linalg import spsolve</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from scipy.spatial.distance import correlation</span></li>
    </ul></li>
  </ul></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>Pandas</b> (version &gt;= 1.0.0)</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Used for data import, CSV parsing, and metadata handling</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Handles diverse file formats for spectrum import</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Import statement: </span><span class="s15">import pandas as pd</span></li>
  </ul></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>Tkinter</b> (typically included with Python)</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">The GUI framework used for the application interface</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Must be properly installed with Python distribution</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Import statements:</span>
    <ul class="ul3">
      <li class="li27"><span class="s13"></span><span class="s11">import tkinter as tk</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from tkinter import filedialog, messagebox, ttk</span></li>
    </ul></li>
  </ul></li>
</ol>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Optional but Recommended Packages</b></span></h2>
<p class="p25"><span class="s11">These packages enhance functionality but the application can still run without them:</span></p>
<ol class="ol1">
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>scikit-learn</b> (version &gt;= 0.23.0)</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Enables ML-based search functionality</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Provides PCA (Principal Component Analysis) for spectrum analysis</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Import statements (conditionally included):</span>
    <ul class="ul3">
      <li class="li27"><span class="s13"></span><span class="s11">from sklearn.decomposition import PCA</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from sklearn.preprocessing import StandardScaler</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from sklearn.metrics.pairwise import cosine_similarity</span></li>
    </ul></li>
  </ul></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>ReportLab</b> (version &gt;= 3.5.0)</span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Used for PDF report generation</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Enables exporting search results as formatted PDF documents</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Import statements (conditionally included):</span>
    <ul class="ul3">
      <li class="li27"><span class="s13"></span><span class="s11">from reportlab.lib.pagesizes import letter</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from reportlab.pdfgen import canvas</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from reportlab.lib.styles import getSampleStyleSheet</span></li>
      <li class="li27"><span class="s13"></span><span class="s11">from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer</span></li>
    </ul></li>
  </ul></li>
</ol>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Data Files</b></span></h2>
<p class="p25"><span class="s11">The application also requires certain data files to be present in the working directory:</span></p>
<ol class="ol1">
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>RRUFF_Export_with_Hey_Classification.csv</b><b></b></span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Contains Hey Classification data for minerals</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Used for mineral identification and classification</span></li>
  </ul></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>raman_database.pkl</b><b></b></span>
  <ul class="ul2">
    <li class="li28"><span class="s13"></span><span class="s11">Database file storing Raman spectra</span></li>
    <li class="li28"><span class="s13"></span><span class="s11">Created automatically if not present</span></li>
  </ul></li>
  <li class="li35">Spectra format
  <ul class="ul2">
    <li class="li35">RRUFF</li>
    <li class="li35">Plain CSV</li>
    <li class="li35">Header info allowed.<span class="Apple-converted-space">  </span>Use # at the beginning of the line</li>
  </ul></li>
</ol>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Package Installation</b></span></h2>
<p class="p25"><span class="s11">You can install all required packages using pip:</span></p>
<p class="p27"><span class="s11">pip install numpy==1.20.3 matplotlib==3.4.3 scipy==1.7.1 pandas==1.3.4 scikit-learn==1.0.1 reportlab==3.6.2</span></p>
<p class="p25"><span class="s11">Or using a requirements.txt file:</span></p>
<p class="p27"><span class="s11">numpy&gt;=1.19.0</span></p>
<p class="p27"><span class="s11">matplotlib&gt;=3.3.0</span></p>
<p class="p27"><span class="s11">scipy&gt;=1.5.0</span></p>
<p class="p27"><span class="s11">pandas&gt;=1.0.0</span></p>
<p class="p27"><span class="s11">scikit-learn&gt;=0.23.0</span></p>
<p class="p27"><span class="s11">reportlab&gt;=3.5.0</span></p>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Environment Handling in the Code</b></span></h2>
<p class="p25"><span class="s11">The application includes graceful fallbacks for optional components:</span></p>
<ol class="ol1">
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>Machine Learning Methods</b>:<br>
</span><span class="s15">try:</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from sklearn.decomposition import PCA</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from sklearn.preprocessing import StandardScaler</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from sklearn.metrics.pairwise import cosine_similarity</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>SKLEARN_AVAILABLE = True</span></li>
  <li class="li27"><span class="s13"></span><span class="s11">except ImportError:</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>SKLEARN_AVAILABLE = False</span></li>
  <li class="li35"></li>
  <li class="li25"><span class="s13"><b></b></span><span class="s11"><b>PDF Generation</b>:<br>
</span><span class="s15">try:</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from reportlab.lib.pagesizes import letter</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from reportlab.pdfgen import canvas</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from reportlab.lib.styles import getSampleStyleSheet</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>from reportlab.lib.units import inch</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>REPORTLAB_AVAILABLE = True</span></li>
  <li class="li27"><span class="s13"></span><span class="s11">except ImportError:</span></li>
  <li class="li27"><span class="s13"></span><span class="s11"><span class="Apple-converted-space">    </span>REPORTLAB_AVAILABLE = False</span></li>
  <li class="li35"></li>
</ol>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>System Requirements</b></span></h2>
<p class="p25"><span class="s11">Beyond Python and package dependencies, the application requires:</span></p>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Display</b>: GUI capability (X11 on Linux, native on Windows/macOS)</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Memory</b>: At least 4GB RAM recommended for ML functionality</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Storage</b>: ~500MB for application and database</span></li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.9px 0.0px; font: 18.0px Times; -webkit-text-stroke: #000000"><span class="s11"><b>Development Environment Recommendations</b></span></h2>
<p class="p25"><span class="s11">For development or modification of the application:</span></p>
<ul class="ul1">
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>IDE</b>: Visual Studio Code or PyCharm recommended for easier package management</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Virtual Environment</b>: Use venv or conda to isolate dependencies</span></li>
  <li class="li28"><span class="s13"><b></b></span><span class="s11"><b>Version Control</b>: Git for tracking code changes</span></li>
</ul>
<p class="p25"><span class="s11">This comprehensive environment specification should ensure successful deployment and execution of the Raman Analysis application across different systems.</span></p>
</div>
</body>
</html>
